|          | FSM  | HFSM | Animator | State Tree | Behavior Tree |
| -------- | ---- | ---- | -------- | ---------- | ------------- |
| å¹¶è¡Œ     | âŒ    | âŒ    | âœ…        |            | âœ…             |
| è·¨å±‚è¿‡æ¸¡ | â›”ğŸš«â  | âœ…    | âœ…        | âœ…          | âŒ             |
| Selector | âŒ    | âŒ    | âœ…        | âœ…          | âœ…             |
|          |      |      |          |            |               |
|          |      |      |          |            |               |

Animator æ²¡æœ‰ä¸æ¯«æŠ˜æ‰£çš„å®ç°äº†HFSMçš„æ‰€æœ‰åŠŸèƒ½ã€‚

**æ³¨æ„Animatorçš„Create Sub-State Machineæ‰æ˜¯HFSMçš„ä¸»è¦ç‰¹å¾ï¼Œå’ŒLayersåŠŸèƒ½æ— å…³ï¼Œä¸è¦è¢«â€œå±‚â€è¿™ä¸ªåå­—è¯¯å¯¼ã€‚Animatorçš„LayersåŠŸèƒ½æ›´ä¸»è¦çš„å¥½ä½¿è¦å®ç°å¹¶è¡ŒçŠ¶æ€éœ€æ±‚ã€‚**

Animator ç¼–è¾‘å™¨è¿›å…¥SubMachineæ—¶ä¸Šå±‚å°±ä¸è§äº†ï¼Œæ— æ³•çœ‹åˆ°æ•´ä¸ªHFSMçš„å…¨è²Œã€‚

Animator æ˜¯çŠ¶æ€æœºï¼Œæ˜¯HFSMçš„ä¸€ä¸ªå®ç°ã€‚ä½†æ˜¯ ä¸æ˜¯æ‰€æœ‰çš„çŠ¶æ€æœºï¼ŒHFSMéƒ½æ˜¯Animator ã€‚

Animator æ˜¯ä¸€ä¸ªçŠ¶æ€æœºçš„è¶…é›†ã€‚

ä¸èƒ½å°†çŠ¶æ€æœºæ¦‚å¿µå’ŒAnimatoræ··æ·†ã€‚Animatoræ˜¯ä¸€ä¸ªåºç„¶å¤§ç‰©ï¼ŒAnimatoråŒ…å«å®ç°çš„featureå¤ªå¤šäº†ï¼Œä¸æ˜¯çŠ¶æ€æœºä¸€ä¸ªè¯å¯èƒ½æ¦‚å†µçš„ã€‚





Animator çš„AnyStateNodeå®ç°äº†ä»ä»»æ„çŠ¶æ€åˆ‡æ¢åˆ°ä»»æ„çŠ¶æ€ï¼Œå®ç°äº†Abortã€‚



è™½ç„¶Animatorå¾ˆå‰å®³ï¼Œå½“å¹¶ä¸ç­‰äºå¥½ç”¨ã€‚ä½œä¸ºä¸€ä¸ªComponentæ¥è¯´ï¼Œæ‚ç³…äº†å¤ªå¤šåŠŸèƒ½ï¼Œå¹¶ä¸”è€¦åˆä¸¥é‡ï¼Œä¸ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚

å¦‚æœèƒ½å°†Animatoræ‹†åˆ†ä¸ºçŠ¶æ€æœºå’ŒåŠ¨ç”»æ’­æ”¾2ä¸ªéƒ¨åˆ†ä¼šæ›´å¥½ï¼ˆä¼¼ä¹ä¼šå›åˆ°Animationæ—¶ä»£ğŸ˜‚ï¼‰ã€‚



Animatorä¸å¥½ç”¨ä¸æ˜¯åœ¨çŠ¶æ€æœºè®¾è®¡ä¸Šæœ‰ç¼ºé™·ï¼Œè€Œæ˜¯åœ¨å‚æ•°ç»‘å®šå’Œå¯¹Ownerè°ƒç”¨ä¸Šæœ‰ç¼ºé™·ã€‚

Ownerè¦é©±åŠ¨çŠ¶æ€æœºï¼Œå¿…é¡»ç”¨Animator.SetValueã€‚

çŠ¶æ€æœºè¦è°ƒç”¨Owneræ–¹æ³•ï¼Œè¦ä½¿ç”¨StateMachineBehaviourï¼Œå†…éƒ¨è¿˜è¦animator.GetComponentæ‰èƒ½æ‹¿åˆ°Agentã€‚

Q: ä¸ºä»€ä¹ˆçŠ¶æ€æœºä¸èƒ½ç›´æ¥è¯»å–Owneræˆå‘˜å€¼å‘¢ï¼Ÿä¸ºä»€ä¹ˆAnimatorä¸èƒ½ç›´æ¥è°ƒç”¨Owneræ–¹æ³•å‘¢ï¼Ÿ  
A:  
- Ownerç»„ä»¶æˆ–è€…æˆå‘˜å€¼å¯èƒ½æ˜¯åŠ¨æ€çš„ã€‚
- å¿…é¡»ä½¿ç”¨åå°„æ‰èƒ½å®ç°ï¼Œç‰¹åˆ«éº»çƒ¦ã€‚
- é©±åŠ¨æ–¹å¼ä¸åŒï¼Œç›´æ¥è¯»å–Ownerå¿…é¡»æ˜¯è½®è¯¢ï¼ŒAnimator.SetValueæ˜¯äº‹ä»¶ã€‚æ€§èƒ½å·®åˆ«å·¨å¤§ã€‚  

ä½†æ˜¯å°±ç»“è®ºæ¥è¯´ï¼Œç°åœ¨çš„Animatorä¸å¥½ç”¨ï¼Œä¸€ä¸‡ä¸ªåŸå› ä¹Ÿç«™ä¸ä½è„šã€‚


è·¨å±‚è°ƒåº¦å¼Šç«¯ï¼š    
è¡Œä¸ºæ ‘å¢åŠ åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå‰¯ä½œç”¨å¾ˆå°ï¼Œèƒ½è¿‡æ¸¡åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„åªæœ‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚  
åˆ†å±‚çŠ¶æ€æœºå¢åŠ åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸çŸ¥é“æœ‰å¤šå°‘æœªçŸ¥è¿‡æ¸¡æŒ‡å‘è¿™ä¸ªèŠ‚ç‚¹ã€‚ä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥ä¸ªè¿‡æ¸¡åˆ°ä»»ä½•èŠ‚ç‚¹ï¼Œå¯¹ç»´æŠ¤æ¥è¯´æ˜¯å¾ˆå¯æ€•çš„ã€‚


# å¹¶è¡Œ

[Unity - æ‰‹åŠ¨ï¼šåŠ¨ç”»å›¾å±‚ (unity3d.com)](https://docs.unity3d.com/2023.1/Documentation/Manual/AnimationLayers.html)

# åˆ†å±‚æœ‰é™çŠ¶æ€æœºï¼ˆHFSMï¼‰
- EntryNode
- ExitNode
- AnyStateNode
- UpStateMachine
  
Animator æŒ‡å®šå­å±‚åï¼Œå¦‚æœä¸æŒ‡å®šå­çŠ¶æ€ï¼Œä¼šèµ°é»˜è®¤çŠ¶æ€ã€‚
Enter å¯¹æ¯ä¸ªçŠ¶æ€è®¾ç½®è¿‡æ¸¡ï¼Œæ¯ä¸ªçŠ¶æ€å¯¹Exitè®¾ç½®è¿‡æ¸¡ï¼Œå®Œå…¨å¯ä»¥æ¨¡æ‹Ÿ Selectorã€‚
é€šè¿‡EntryNodeå’ŒExitNode, å®Œå…¨å¯ä»¥æ¨¡æ‹Ÿ Selectorï¼ŒSequenceã€‚
HFSM å…è®¸ä»ä¸€ä¸ªå­çŠ¶æ€æœºçš„å­çŠ¶æ€ï¼Œè¿‡æ¸¡åˆ°å¦ä¸€ä¸ªå­çŠ¶æ€æœºçš„å­çŠ¶æ€ã€‚  
è¡Œä¸ºæ ‘åˆ™ä¸è¡Œï¼Œä¸èƒ½ä»ä¸€ä¸ªåˆ†æ”¯ç›´æ¥è¿‡æ¸¡åˆ°ä¸åŒå±‚çš„åˆ†æ”¯èŠ‚ç‚¹ã€‚
HFSMçš„è¡¨è¾¾èƒ½åŠ›æ¯”è¡Œä¸ºæ ‘æ›´å¼ºã€‚

è¡Œä¸ºæ ‘å¯ä»¥å¹¶è¡Œ2ä¸ªèŠ‚ç‚¹ï¼ŒçŠ¶æ€æœºåˆ™ä¸è¡Œã€‚çŠ¶æ€æœºé€šè¿‡layeræ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

anystatenodeæä¾›äº†æ›´å¼ºå¤§çš„è¿‡æ¸¡èƒ½åŠ›ã€‚

ä¸€ä¸ªæ˜æ˜¾ç‰¹å¾æ˜¯çŠ¶æ€æœºåµŒå¥—å¦ä¸€ä¸ªçŠ¶æ€æœºï¼Œå…¶ä»–çš„åŠŸèƒ½ç‚¹å¹¶æ²¡æœ‰æ˜ç¡®å®šä¹‰ã€‚



- çŠ¶æ€å¯ä»¥è¿‡æ¸¡åˆ°å­çŠ¶æ€æœºï¼Œä½†å¹¶ä¸æŒ‡å®šå­çŠ¶æ€æœºå†…çš„å“ªä¸€ä¸ªçŠ¶æ€ï¼Œç”±å­çŠ¶æ€æœºè‡ªå·±å†³å®šã€‚è¿™æ˜¯ä¸€ç§Selectoræœºåˆ¶ã€‚

> [Unity - Manual: Sub-State Machines (unity3d.com)](https://docs.unity3d.com/2023.1/Documentation/Manual/NestedStateMachines.html)As noted above, a sub-state machine is just a way of visually collapsing a group of states in the editor, so when you make a transition to a sub-state machine, you have to choose which of its states you want to connect to.  
>
>  ![MecanimSelectSubState.png (504Ã—120) (unity3d.com)](https://docs.unity3d.com/2023.1/Documentation/uploads/Main/MecanimSelectSubState.png)

å®æµ‹ç°åœ¨å·²ç»æ²¡æœ‰è¿™ä¸ªé™åˆ¶äº†ï¼Œåªæ˜¯æ–‡æ¡£æ²¡æ”¹ã€‚å…¶å®æœ¬è´¨ä¸Šä¹Ÿä¸åº”è¯¥å­˜åœ¨è¿™ä¸ªé™åˆ¶ã€‚



å­çŠ¶æ€æœºåœ¨ä¸Šä¸€å±‚`å¯ä»¥å¹¶å¿…é¡»`çœ‹æˆä¸€ä¸ªçŠ¶æ€ã€‚æ—¢ç„¶æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»å…è®¸è¿™ä¸ªçŠ¶æ€åˆ°å…¶ä»–çŠ¶æ€çš„è¿‡æ¸¡ã€‚æ— è®ºå­çŠ¶æ€å†…éƒ¨å¦‚ä½•ï¼Œå­çŠ¶æ€æœºæœ¬èº«åˆ°å…¶ä»–çŠ¶æ€çš„è¿‡æ¸¡æ¡ä»¶éƒ½æ˜¯è¦æ£€æµ‹çš„ï¼Œå¾ˆå¤šHFSMéƒ½æ²¡æœ‰å®ç°è¿™ä¸€ç‚¹ã€‚



# çŠ¶æ€æœºçš„ç‰¹å¾





çŠ¶æ€æœºæ˜¯æ²¡æœ‰Selectoræœºåˆ¶çš„ã€‚åœ¨çŠ¶æ€æœºè¿è¡Œçš„ä»»æ„æ—¶åˆ»ï¼ŒçŠ¶æ€æœºå¿…é¡»å¤„äºæŸç§çŠ¶æ€ã€‚   
å½“æˆ‘ä»¬éœ€è¦ä»æŸä¸ªçŠ¶æ€é€€å‡ºæ—¶ï¼Œå¿…é¡»è¦æœ‰æ˜ç¡®è¿‡æ¸¡æŒ‡å‘å¦ä¸€ä¸ªstateã€‚  
Qï¼šå½“æˆ‘ä»¬å¿…é¡»é€€å‡ºï¼Œåˆä¸çŸ¥é“é€€å‡ºåå»å“ªä¸ªçŠ¶æ€æ—¶æ€ä¹ˆåŠï¼Ÿ

Aï¼šè¿™å°±æ˜¯Selectoræœºåˆ¶ã€‚çŠ¶æ€æœºå¯ä»¥æ ¹æ®æ¡ä»¶ï¼Œä»æ‰€æœ‰çŠ¶æ€èŠ‚ç‚¹ä¸­é€‰æ‹©å‡ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚

Animator çš„ExitNodeå®ç°æ— è´£ä»»é€€å‡ºã€‚

Animator çš„EnterNodeå®ç°äº†Selectorã€‚

# è¡Œä¸ºæ ‘çš„ç‰¹å¾

ä¸€ä¸ªSeqä¸‹åˆä¸¤ä¸ªTaskï¼ŒSleepï¼ŒSayã€‚ é€»è¾‘æ˜¯ï¼Œç¡é†’äº†è¯´å¥è¯ã€‚å¯ä»¥ç”±Sleepè¿‡æ¸¡åˆ°Sayï¼Œä½†æ˜¯åœ¨Sayåæ— æ³•åœ¨åˆ‡æ¢æ¢å›Sleepï¼Œé™¤éä¿®æ”¹ä¸Šå±‚æˆ–è€…ä¸Šä¸Šå±‚èŠ‚ç‚¹ã€‚

å› ä¸ºè¡Œä¸ºæ ‘åœ¨åŒä¸€ä¸ªå±‚ä¹‹é—´æ‰§è¡Œæ—¶ï¼Œæ€»æ˜¯æŒ‰é¡ºåºçš„ï¼Œæ˜¯ä¸èƒ½å›å¤´çš„ã€‚çŠ¶æ€æœºä¸ç„¶ï¼ŒåŒä¸€ä¸ªå±‚æ¬¡æ‰§è¡Œè¿‡æ¸¡æ˜¯ä»»æ„çš„ã€‚







---



# FSM HFSM ST BT è¡¨è¾¾èƒ½åŠ›ç›¸åŒå—ï¼Ÿ

ç­”æ¡ˆ: ä¸ç›¸åŒã€‚



æ›´åŠ å…·ä½“çš„è¯´ï¼Œç”±äºæ²¡æœ‰æ˜ç¡®çš„åŠŸèƒ½æ ‡å‡†å®šä¹‰ï¼Œæ‰€ä»¥æ¯ä¸ªåº“å®ç°çš„Featureå¤šå°‘ä¹Ÿä¸åŒï¼Œè¡¨è¾¾èƒ½åŠ›æ˜¯ä¸å¯èƒ½ç›¸åŒçš„ã€‚

ç”±äºFeatureçš„ä¸åŒï¼Œä¾èµ–äºè¿™äº›Featureçš„é¡¹ç›®ï¼Œæ˜¯ä¸èƒ½éšæ„æ›´æ¢AIæ’ä»¶çš„ã€‚



ä»ç»“æ„ä¸Šæ¥è¯´ï¼š[æ•°æ®ç»“æ„æ ‘å’Œå›¾ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ (qastack.cn)](https://qastack.cn/programming/7423401/whats-the-difference-between-the-data-structure-tree-and-graph) 

StateTreeå°†å›¾ç»“æ„æ”¹æˆæ ‘ç»“æ„ã€‚

StateTree æ˜¯ä¸€ç§HFSMçš„å—é™å½¢å¼ã€‚



ä»çŠ¶æ€åˆ‡æ¢è¿‡æ¸¡æ€§æ¥è¯´ï¼š

è¡Œä¸ºæ ‘æ˜¯ä¸€ç§StateTreeçš„å—é™å½¢å¼ã€‚



# æˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ˜¯ä»€ä¹ˆï¼Ÿ

- å½“æˆ‘ä»¬çŸ¥é“è¦è¿‡æ¸¡åˆ°å“ªä¸ªçŠ¶æ€æ—¶ï¼Œç›´æ¥è¿‡æ¸¡ã€‚å½“æˆ‘ä»¬ä¸çŸ¥é“è¦å»å“ªä¸ªçŠ¶æ€ï¼Œç”±æ•´ä½“é€‰å‡ºä¸€ä¸ªçŠ¶æ€ã€‚
- æ‰§è¡Œå½“å‰çŠ¶æ€æ—¶ï¼Œä»ä¸å…³å¿ƒä¸Šä¸€ä¸ªçŠ¶æ€æ˜¯ä»€ä¹ˆã€‚



# å‚è€ƒ

- [Introduction to behavior trees - Robohub](https://robohub.org/introduction-to-behavior-trees/)
- [Finite-state machine - Wikipedia](https://en.wikipedia.org/wiki/Finite-state_machine)
- [Behavior tree (artificial intelligence, robotics and control) - Wikipedia](https://en.wikipedia.org/wiki/Behavior_tree_(artificial_intelligence,_robotics_and_control))
- [Inspiaaa/UnityHFSM: A simple yet powerful class based hierarchical finite state machine for Unity3D (github.com)](https://github.com/Inspiaaa/UnityHFSM)
- [å­¦ä¹ ç¬”è®°2.5-----åˆ†å±‚æœ‰é™çŠ¶æ€æœº - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/558422986)
- [Unity - Manual: State Machine Basics (unity3d.com)](https://docs.unity3d.com/2023.1/Documentation/Manual/StateMachineBasics.html)
- [è¡Œä¸ºæ ‘æ¦‚å¿µä¸ç»“æ„ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/92298402)

  

































